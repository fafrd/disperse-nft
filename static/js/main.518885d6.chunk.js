(this["webpackJsonpdisperse-nft"]=this["webpackJsonpdisperse-nft"]||[]).push([[0],{35:function(t){t.exports=JSON.parse('[{"inputs":[{"internalType":"contract IERC1155","name":"token","type":"address"},{"internalType":"address[]","name":"recipients","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"values","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"disperse","outputs":[],"stateMutability":"nonpayable","type":"function"}]')},36:function(t){t.exports=JSON.parse('[{"constant":false,"inputs":[{"name":"_operator","type":"address"},{"name":"_approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_id","type":"uint256"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owners","type":"address[]"},{"name":"_ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"}]')},46:function(t,e,a){},48:function(t,e,a){},51:function(t,e){},61:function(t,e,a){"use strict";a.r(e);var s=a(16),n=a.n(s),i=a(33),r=a.n(i),c=(a(46),a(34)),o=a(2),l=a.n(o),u=a(17),h=a(3),d=a(4),p=a(8),b=a(6),j=a(5),g=a(24),y=(a(48),a(7)),f=function(t){Object(b.a)(a,t);var e=Object(j.a)(a);function a(){return Object(h.a)(this,a),e.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var t=this.props.valid?"\u2705":"\ud83e\udd14";return Object(y.jsx)("span",{className:"valid",children:t})}}]),a}(n.a.Component),m=a(35),x=a(36),O=[1,4],v={1:"Ethereum Mainnet",4:"Rinkeby Testnet"},w={1:"",4:"0x7b194fBF78eeb62044985d37c9c4cDF6F4f0CA28"},S=function(t){Object(b.a)(a,t);var e=Object(j.a)(a);function a(t){var s;return Object(h.a)(this,a),(s=e.call(this,t)).state={ethereum:null,provider:null,signer:null,connectedAccounts:[],walletStatus:"no-wallet-detected",chainId:"",contract:"",recipients:"",parsedRecipients:[],ids:"",parsedIds:[],quantities:"",parsedQuantities:[],quantityToggle:"quantityToggleManual",contractError:"empty",recipientsError:"empty",idsError:"empty",quantitiesError:"empty",txnHash:"",failureReason:""},s.handleChange=s.handleChange.bind(Object(p.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(p.a)(s)),s.connectWallet=s.connectWallet.bind(Object(p.a)(s)),s.switchNetwork=s.switchNetwork.bind(Object(p.a)(s)),s}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.setWalletState();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"setWalletState",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,a,s,n,i,r,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("setWalletState"),e=window,a=e.ethereum,s=null,n=null,i="wallet-not-connected",!a){t.next=17;break}return s=new g.a.providers.Web3Provider(a),n=s.getSigner(),t.next=8,s.getNetwork();case 8:return r=t.sent,t.next=11,s.listAccounts();case 11:c=t.sent,console.log("connected accounts: "+JSON.stringify(c)),0===c.length?(console.debug("Setting wallet state: wallet-not-connected"),i="wallet-not-connected"):O.includes(r.chainId)?(console.debug("Setting wallet state: empty (everything good)"),i=""):(console.debug("Setting wallet state: wrong-network"),i="wrong-network"),this.setState({ethereum:a,provider:s,signer:n,chainId:r.chainId,connectedAccounts:c,walletStatus:i}),a.on("chainChanged",this.setWalletState.bind(this)),a.on("accountsChanged",this.setWalletState.bind(this));case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"connectWallet",value:function(){var t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.state.ethereum.request({method:"eth_requestAccounts"});case 2:return t.next=4,this.state.provider.listAccounts();case 4:if(!(t.sent.length>0)){t.next=10;break}return t.next=8,this.setWalletState();case 8:t.next=11;break;case 10:throw Error("Connected to ethereum but provider.listAccounts() returned empty!");case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"switchNetwork",value:function(){var t=Object(u.a)(l.a.mark((function t(e){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.target.id,t.next="button-ethereum"===t.t0?3:"button-rinkeby"===t.t0?5:7;break;case 3:return a=1,t.abrupt("break",8);case 5:return a=4,t.abrupt("break",8);case 7:throw new Error("unexpected switch fallthrough for button id "+e.target.id);case 8:return t.next=10,window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+a.toString(16)}]});case 10:this.setWalletState();case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"calcQtyFromIds",value:function(t){return t.map((function(t){return"1"}))}},{key:"validateContract",value:function(t){t?t.match(/^0x[a-fA-F0-9]{40}$/)?this.setState({contractError:""}):this.setState({contractError:"Unable to parse contract address"}):this.setState({contractError:"empty"})}},{key:"validateRecipients",value:function(t){if(this.setState({parsedRecipients:[]}),t)try{var e=JSON.parse(t.replace(/'/g,'"'));e.every((function(t){return t.match(/^0x[a-fA-F0-9]{40}$/)}))?(this.setState({recipientsError:""}),this.setState({parsedRecipients:e})):this.setState({recipientsError:"Unable to parse recipient address."})}catch(a){this.setState({recipientsError:"Unable to parse recipients array."})}else this.setState({recipientsError:"empty"})}},{key:"validateIds",value:function(t){if(this.setState({parsedIds:[]}),t)try{var e=JSON.parse(t.replace(/'/g,'"'));e.every((function(t){return"string"===typeof t}))?(this.setState({idsError:""}),this.setState({parsedIds:e}),"quantityToggleAuto"===this.state.quantityToggle?this.setState({parsedQuantities:this.calcQtyFromIds(e)}):this.validateQuantities(e,this.state.quantities)):this.setState({idsError:"Unable to parse ID as string."})}catch(a){this.setState({idsError:"Unable to parse IDs array."})}else this.setState({idsError:"empty"})}},{key:"validateQuantities",value:function(t,e){if("quantityToggleAuto"===this.state.quantityToggle)this.setState({quantitiesError:""});else if(e){this.setState({parsedQuantities:[]});try{var a=JSON.parse(e.replace(/'/g,'"'));a.every((function(t){return"string"===typeof t}))?a.length!==t.length?this.setState({quantitiesError:"Invalid length             (found ".concat(t.length," IDs, but ").concat(a.length," quantities)")}):(this.setState({quantitiesError:""}),this.setState({parsedQuantities:a})):this.setState({quantitiesError:"Unable to parse quantity as string."})}catch(s){this.setState({quantitiesError:"Unable to parse quantities array."})}}else this.setState({parsedQuantities:[]}),this.setState({quantitiesError:"empty"})}},{key:"handleChange",value:function(t){switch(this.setState(Object(c.a)({},t.target.name,t.target.value)),t.target.name){case"contract":this.validateContract(t.target.value);break;case"recipients":this.validateRecipients(t.target.value);break;case"ids":this.validateIds(t.target.value);break;case"quantities":this.validateQuantities(this.state.parsedIds,t.target.value);break;case"quantityToggle":"quantityToggleAuto"===t.target.value&&this.setState({parsedQuantities:this.calcQtyFromIds(this.state.parsedIds)});break;default:console.warn("unexpected switch fallthrough for event "+t.target.name)}}},{key:"handleSubmit",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,a,s,n,i,r,c,o,u,h,d,p,b,j,y,f,O;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("Dispersing tokens"),t.prev=1,e=this.state.contract,a=JSON.parse(this.state.recipients),s=JSON.parse(this.state.ids),n="quantityToggleAuto"==this.state.quantityToggle?this.state.parsedQuantities:JSON.parse(this.state.quantities),t.next=13;break;case 8:return t.prev=8,t.t0=t.catch(1),console.error(t.t0),this.setState({failureReason:"Unable to parse parameters",walletStatus:"transaction-fail"}),t.abrupt("return");case 13:return console.log("Ready to commit transaction. Parameters:\n  contract: \t".concat(JSON.stringify(e),",\n  recipients: \t").concat(JSON.stringify(a),",\n  token ids: \t").concat(JSON.stringify(s),",\n  quantities: \t").concat(JSON.stringify(n),',\n  binary data: \t"0x"\n    ')),t.prev=14,t.next=17,new g.a.Contract(this.state.contract,x,this.state.signer);case 17:return i=t.sent,c=Array(s.length).fill(this.state.connectedAccounts[0]),t.next=21,i.balanceOfBatch(c,s);case 21:r=t.sent,console.log("balances: "),console.log(r),t.next=31;break;case 26:return t.prev=26,t.t1=t.catch(14),console.error(t.t1),this.setState({failureReason:"Unable to determine contract balance. Did you provide a valid ERC-1155 NFT contract address?",walletStatus:"transaction-fail"}),t.abrupt("return");case 31:o=0;case 32:if(!(o<s.length)){t.next=41;break}if(!(n[o]>parseInt(r[o],16))){t.next=38;break}return u="Insufficient balance for token ID ".concat(s[o],". You are trying to send ").concat(n[o],", but have ").concat(r[o],"."),console.error(u),this.setState({failureReason:u,walletStatus:"transaction-fail"}),t.abrupt("return");case 38:o++,t.next=32;break;case 41:if(h=w[this.state.chainId]){t.next=47;break}return d="No contract address specified for chainId "+this.state.chainId,console.error(d),this.setState({failureReason:d,walletStatus:"transaction-fail"}),t.abrupt("return");case 47:return this.setState({walletStatus:"approve-pending"}),t.prev=48,t.next=51,i.isApprovedForAll(this.state.connectedAccounts[0],h);case 51:p=t.sent,t.next=59;break;case 54:return t.prev=54,t.t2=t.catch(48),console.error(t.t2),this.setState({failureReason:"Unable to determine contract approval. Did you provide a valid ERC-1155 NFT contract address?",walletStatus:"transaction-fail"}),t.abrupt("return");case 59:if(console.log("existing approval status: "+p),p){t.next=78;break}return t.prev=61,t.next=64,i.setApprovalForAll(h,!0);case 64:return b=t.sent,this.setState({txnHash:b.hash,walletStatus:"approve-in-progress"}),t.next=68,b.wait();case 68:j=t.sent,console.log("Transaction success. receipt: "),console.log(j),t.next=78;break;case 73:return t.prev=73,t.t3=t.catch(61),console.error(t.t3),this.setState({failureReason:JSON.stringify(t.t3,null,2),walletStatus:"transaction-fail"}),t.abrupt("return");case 78:return this.setState({walletStatus:"disperse-pending"}),t.next=81,new g.a.Contract(h,m,this.state.signer);case 81:return y=t.sent,t.prev=82,t.next=85,y.disperse(e,a,s,n,"0x");case 85:return f=t.sent,this.setState({txnHash:f.hash,walletStatus:"disperse-in-progress"}),t.next=89,f.wait();case 89:O=t.sent,console.log("Transaction success. receipt: "),console.log(O),this.setState({walletStatus:"disperse-success"}),t.next=99;break;case 95:t.prev=95,t.t4=t.catch(82),console.error(t.t4),this.setState({failureReason:JSON.stringify(t.t4,null,2),walletStatus:"transaction-fail"});case 99:case"end":return t.stop()}}),t,this,[[1,8],[14,26],[48,54],[61,73],[82,95]])})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t,e,a,s,n=this;t=this.state.contractError?Object(y.jsx)("i",{children:this.state.contractError}):this.state.contract,e=this.state.recipientsError?Object(y.jsx)("i",{children:this.state.recipientsError}):1===this.state.parsedRecipients.length?"1 recipient":"".concat(this.state.parsedRecipients.length," recipients"),a=this.state.idsError?Object(y.jsx)("i",{children:this.state.idsError}):1===this.state.parsedIds.length?"1 id":"".concat(this.state.parsedIds.length," ids"),"quantityToggleAuto"===this.state.quantityToggle?s="1 of each ID, for each recipient":this.state.quantitiesError?s=Object(y.jsx)("i",{children:this.state.quantitiesError}):(s=this.state.quantities,s=1===this.state.parsedQuantities.length?"1 quantity":"".concat(this.state.parsedQuantities.length," quantities"));var i=this.state.contractError||this.state.recipientsError||this.state.idsError||this.state.quantitiesError&&"quantityToggleManual"===this.state.quantityToggle,r=this.state.quantities,c=!1;"quantityToggleAuto"===this.state.quantityToggle&&(r=JSON.stringify(this.state.parsedQuantities),c=!0);var o=v[this.state.chainId]?v[this.state.chainId]:"unsupported network",l=this.state.connectedAccounts.length>0&&this.state.provider?Object(y.jsxs)("p",{children:["Wallet connected to ",o,"."]}):null;return Object(y.jsxs)("div",{className:"App",children:[Object(y.jsxs)("header",{className:"App-header",children:[Object(y.jsx)("h1",{children:"Disperse NFT"}),Object(y.jsx)("h2",{children:"Batch-send your ERC1155 tokens to one or more recipients."}),Object(y.jsxs)("p",{children:["This tool allows you to send many ERC-1155 NFTs in a single transaction. This only works for NFTs that support multiple ",Object(y.jsx)("i",{children:"copies"})," of the same NFT, such as Rarible multiples, or Curio Cards."]}),Object(y.jsxs)("p",{children:["Source: ",Object(y.jsx)("a",{href:"https://github.com/fafrd/disperse-nft-contract",children:"github.com/fafrd/disperse-nft-contract"})]})]}),Object(y.jsx)("main",{className:"no-wallet-detected"===this.state.walletStatus?"":"hidden",children:Object(y.jsxs)("h3",{children:["No wallet detected. Install metamask: ",Object(y.jsx)("a",{href:"https://metamask.io/",children:"metamask.io"})]})}),Object(y.jsx)("main",{className:"wallet-not-connected"===this.state.walletStatus?"":"hidden",children:Object(y.jsxs)("h3",{children:["Connect your wallet to continue: ",Object(y.jsx)("button",{id:"connect",type:"button",onClick:this.connectWallet,children:"Connect Wallet"})]})}),Object(y.jsxs)("main",{className:"wrong-network"===this.state.walletStatus?"":"hidden",children:[Object(y.jsx)("h3",{children:"Switch a supported network to continue: "}),Object(y.jsxs)("ul",{children:[Object(y.jsx)("li",{children:Object(y.jsx)("h3",{children:Object(y.jsx)("button",{className:"switchNetwork",id:"button-ethereum",type:"button",onClick:this.switchNetwork,children:"Ethereum"})})}),Object(y.jsx)("li",{children:Object(y.jsx)("h3",{children:Object(y.jsx)("button",{className:"switchNetwork",id:"button-rinkeby",type:"button",onClick:this.switchNetwork,children:"Rinkeby testnet"})})})]})]}),Object(y.jsx)("main",{className:"approve-pending"===this.state.walletStatus?"":"hidden",children:Object(y.jsx)("h3",{children:"Sign transaction to approve NFT dispersal..."})}),Object(y.jsx)("main",{className:"approve-in-progress"===this.state.walletStatus?"":"hidden",children:Object(y.jsxs)("h3",{children:["Approval transaction in progress. Tx hash: ",this.state.txnHash]})}),Object(y.jsx)("main",{className:"disperse-pending"===this.state.walletStatus?"":"hidden",children:Object(y.jsx)("h3",{children:"Sign transaction to disperse NFT..."})}),Object(y.jsx)("main",{className:"disperse-in-progress"===this.state.walletStatus?"":"hidden",children:Object(y.jsxs)("h3",{children:["Disperse tranasction in progress. Tx hash: ",this.state.txnHash]})}),Object(y.jsx)("main",{className:"disperse-success"===this.state.walletStatus?"":"hidden",children:Object(y.jsxs)("h3",{children:["NFT dispersal complete! ",this.state.txnHash]})}),Object(y.jsxs)("main",{className:"transaction-fail"===this.state.walletStatus?"":"hidden",children:[Object(y.jsx)("h3",{children:"NFT dispersal failed!"}),Object(y.jsx)("p",{children:Object(y.jsx)("code",{children:this.state.failureReason})}),Object(y.jsx)("h3",{children:Object(y.jsx)("button",{id:"reset",type:"button",onClick:function(){return n.setState({walletStatus:""})},children:"Reset"})})]}),Object(y.jsxs)("main",{className:""===this.state.walletStatus?"":"hidden",children:[Object(y.jsxs)("form",{autoComplete:"off",children:[Object(y.jsxs)("label",{htmlFor:"contract",children:["NFT contract ",Object(y.jsx)("i",{children:"(address)"})]}),Object(y.jsx)("div",{className:"input-wrapper",children:Object(y.jsx)("input",{type:"text",name:"contract",value:this.state.contract,autoComplete:"off",onChange:this.handleChange,maxLength:"42",placeholder:"i.e. 0x73DA73EF3a6982109c4d5BDb0dB9dd3E3783f313"})}),Object(y.jsxs)("label",{htmlFor:"recipients",children:["Recipients ",Object(y.jsx)("i",{children:"(array of addresses, as strings)"})]}),Object(y.jsx)("div",{className:"input-wrapper",children:Object(y.jsx)("input",{type:"text",name:"recipients",value:this.state.recipients,autoComplete:"off",onChange:this.handleChange,placeholder:'i.e. ["0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266", "0x70997970C51812dc3A010C7d01b50e0d17dc79C8", ...]'})}),Object(y.jsxs)("label",{htmlFor:"ids",children:["IDs ",Object(y.jsx)("i",{children:"(array of NFT IDs, sorted, as strings)"})]}),Object(y.jsx)("div",{className:"input-wrapper",children:Object(y.jsx)("input",{type:"text",name:"ids",value:this.state.ids,autoComplete:"off",onChange:this.handleChange,placeholder:'i.e. ["21", "22", "23"]'})}),Object(y.jsxs)("label",{htmlFor:"quantities",children:["Quantities ",Object(y.jsx)("i",{children:"(array of quantities, order corresponding to IDs, as strings)"})]}),Object(y.jsxs)("div",{className:"input-radio-wrapper",children:[Object(y.jsxs)("div",{className:"input-radio-wrapper-item",children:[Object(y.jsx)("input",{type:"radio",id:"quantityToggleManual",name:"quantityToggle",value:"quantityToggleManual",onChange:this.handleChange,checked:"quantityToggleManual"===this.state.quantityToggle}),Object(y.jsx)("label",{htmlFor:"quantityToggleManual",children:"Manual selection"})]}),Object(y.jsxs)("div",{className:"input-radio-wrapper-item",children:[Object(y.jsx)("input",{type:"radio",id:"quantityToggleAuto",name:"quantityToggle",value:"quantityToggleAuto",onChange:this.handleChange,checked:"quantityToggleAuto"===this.state.quantityToggle}),Object(y.jsx)("label",{htmlFor:"quantityToggleAuto",children:"Automatic selection (1 of each ID, for each recipient)"})]})]}),Object(y.jsx)("div",{className:"input-wrapper quantity-input",children:Object(y.jsx)("input",{type:"text",name:"quantities",value:r,disabled:c,autoComplete:"off",onChange:this.handleChange,placeholder:'i.e. ["1", "2", "1"]'})})]}),l,Object(y.jsxs)("p",{children:["Contract: ",t," ",Object(y.jsx)(f,{valid:!this.state.contractError})]}),Object(y.jsxs)("p",{children:["Recipients: ",e," ",Object(y.jsx)(f,{valid:!this.state.recipientsError})]}),Object(y.jsxs)("p",{children:["NFT IDs: ",a," ",Object(y.jsx)(f,{valid:!this.state.idsError})]}),Object(y.jsxs)("p",{children:["Quantities: ",s," ",Object(y.jsx)(f,{valid:"quantityToggleAuto"===this.state.quantityToggle||!this.state.quantitiesError})]}),Object(y.jsx)("div",{className:"button-container",children:Object(y.jsx)("button",{id:"disperse",type:"button",disabled:i,onClick:this.handleSubmit,children:"Disperse"})})]})]})}}]),a}(n.a.Component);r.a.render(Object(y.jsx)(n.a.StrictMode,{children:Object(y.jsx)(S,{})}),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.518885d6.chunk.js.map